<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard - Free Version</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; transition: filter 0.3s; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        
        .search-box {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
        }
        .search-box input {
            flex: 1; padding: 15px; border: none; border-radius: 10px; font-size: 16px; outline: none;
        }
        .search-box button {
            padding: 15px 30px; border: none; border-radius: 10px;
            background: #667eea; color: white; cursor: pointer; transition: 0.3s;
            font-weight: bold;
        }

        .main-weather {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px; margin-bottom: 30px; color: white;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .location { font-size: 2.5em; font-weight: bold; }
        .temperature { font-size: 5em; font-weight: 300; }
        .weather-desc { font-size: 1.5em; text-transform: capitalize; opacity: 0.9; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px; color: white; text-align: center;
        }

        /* Spinner Styles */
        #loader {
            display: none;
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }
        .spinner {
            width: 50px; height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .blur { filter: blur(5px); pointer-events: none; }
    </style>
</head>
<body>

    <div id="loader"><div class="spinner"></div></div>

    <div class="container" id="mainContainer">
        <div class="header">
            <h1>Weather Dashboard</h1>
            <p id="date"></p>
        </div>

        <div class="search-box">
            <input type="text" placeholder="Enter city name..." id="cityInput" onkeydown="if(event.key === 'Enter') searchWeather()">
            <button onclick="searchWeather()">Search</button>
        </div>

        <div class="main-weather">
            <div class="location" id="city">Detecting location...</div>
            <div class="temperature" id="temperature">--째C</div>
            <div class="weather-desc" id="condition">Please wait...</div>
        </div>

        <div class="stats-grid">
            <div class="stat-card"><h3>Feels Like</h3><div class="value" id="feelsLike">--</div></div>
            <div class="stat-card"><h3>Humidity</h3><div class="value" id="humidity">--</div></div>
            <div class="stat-card"><h3>Wind</h3><div class="value" id="wind">--</div></div>
            <div class="stat-card"><h3>Pressure</h3><div class="value" id="pressure">--</div></div>
            <div class="stat-card"><h3>Visibility</h3><div class="value" id="visibility">--</div></div>
        </div>

        <div class="forecast-section">
            <h2 style="color:white;margin-bottom:10px;">5-Day Forecast</h2>
            <div id="forecastGrid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;"></div>
        </div>
    </div>

    <script>
        // ...existing code...
        const KEY = '65906519346f9ed87f955ce9d865a762'; 

        window.onload = function() {
            updateDate();
            getUserLocation();
        };

        function updateDate() {
            const now = new Date();
            document.getElementById('date').textContent = now.toLocaleDateString(undefined, { 
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
            });
        }

        async function searchWeather() {
            const cityInput = document.getElementById('cityInput').value;
            if (!cityInput) return;

            showLoader();
            try {
                // Fetch current weather
                const url = `https://api.openweathermap.org/data/2.5/weather?q=${cityInput}&units=metric&appid=${KEY}`;
                const response = await fetch(url);
                const data = await response.json();

                // Fetch forecast
                await fetchForecast({city: cityInput});

                if (response.ok) {
                    updateUI(data);
                } else {
                    alert("Error: " + data.message);
                }
            } catch (err) {
                alert("Something went wrong!");
            } finally {
                hideLoader();
            }
        }

        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (position) => {
                    const { latitude, longitude } = position.coords;
                    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&units=metric&appid=${KEY}`;
                    const res = await fetch(url);
                    const data = await res.json();
                    updateUI(data);
                    await fetchForecast({lat: latitude, lon: longitude});
                }, () => {
                    document.getElementById('city').textContent = "Search manually above";
                });
            }
        }

        async function fetchForecast({city, lat, lon}) {
            let url = '';
            if (city) {
                url = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&units=metric&appid=${KEY}`;
            } else if (lat && lon) {
                url = `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&appid=${KEY}`;
            } else {
                return;
            }
            const response = await fetch(url);
            const data = await response.json();
            if (response.ok) {
                updateForecastUI(data);
            } else {
                document.getElementById('forecastGrid').innerHTML = '<div style="color:white;text-align:center;">No forecast data found.</div>';
            }
        }

        function updateUI(data) {
            document.getElementById('city').textContent = `${data.name}, ${data.sys.country}`;
            document.getElementById('temperature').textContent = `${Math.round(data.main.temp)}째C`;
            document.getElementById('condition').textContent = data.weather[0].description;
            document.getElementById('feelsLike').textContent = `${Math.round(data.main.feels_like)}째`;
            document.getElementById('humidity').textContent = `${data.main.humidity}%`;
            document.getElementById('wind').textContent = `${data.wind.speed} m/s`;
            document.getElementById('pressure').textContent = `${data.main.pressure} hPa`;
            document.getElementById('visibility').textContent = `${(data.visibility / 1000).toFixed(1)} km`;
        }

        function updateForecastUI(data) {
            // OpenWeatherMap forecast returns 3-hour intervals, group by day
            const days = {};
            data.list.forEach(item => {
                const date = new Date(item.dt_txt);
                const day = date.toLocaleDateString();
                if (!days[day]) days[day] = [];
                days[day].push(item);
            });
            // Get up to 5 days
            const dayKeys = Object.keys(days).slice(0,5);
            let html = '';
            dayKeys.forEach(day => {
                const items = days[day];
                // Average values for the day
                let tempSum = 0, cloudSum = 0, rainSum = 0, popSum = 0;
                let count = items.length;
                items.forEach(i => {
                    tempSum += i.main.temp;
                    cloudSum += i.clouds.all;
                    popSum += (i.pop !== undefined ? i.pop : 0);
                    rainSum += (i.rain && i.rain['3h'] ? i.rain['3h'] : 0);
                });
                const avgTemp = (tempSum/count).toFixed(1);
                const avgCloud = Math.round(cloudSum/count);
                const avgPop = Math.round((popSum/count)*100); // percent
                const avgRain = rainSum.toFixed(1);
                // Use first weather icon
                const icon = items[0].weather[0].icon;
                const desc = items[0].weather[0].description;
                html += `<div class="stat-card">
                    <h3>${day}</h3>
                    <img src="https://openweathermap.org/img/wn/${icon}.png" alt="icon" style="width:48px;height:48px;">
                    <div><b>${desc}</b></div>
                    <div>Avg Temp: ${avgTemp}째C</div>
                    <div>Cloudiness: ${avgCloud}%</div>
                    <div>Rain Chance: ${avgPop}%</div>
                </div>`;
            });
            document.getElementById('forecastGrid').innerHTML = html;
        }

        function showLoader() {
            document.getElementById('loader').style.display = 'block';
            document.getElementById('mainContainer').classList.add('blur');
        }

        function hideLoader() {
            document.getElementById('loader').style.display = 'none';
            document.getElementById('mainContainer').classList.remove('blur');
        }
        // ...existing code...
    </script>
</body>
</html>